<style>body{margin:0;background:#000}canvas{height:100vmin;width:100vmin}</style><canvas></canvas><script>function a(){function a(){let a=j.innerWidth,c=j.innerHeight;b.width=a,b.height=c,m.viewport(0,0,a,c)}let b=k.querySelector('canvas');return m=b.getContext('webgl'),j.onresize=a,a(),m.clearColor(0,0,0,1),m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA),m.enable(m.BLEND),m}function b(a,b){let c=m.createShader(a?m.FRAGMENT_SHADER:m.VERTEX_SHADER);return m.shaderSource(c,b),m.compileShader(c),c}function c(a,b,d=1,e=0){let f=Math.cos(e),c=h(e);return new Float32Array([f*d,c*d,0,0,-c*d,f*d,0,0,0,0,1,0,a,b,0,1])}function d(a,b){let c=1e4*h(s++);return l((c-l(c))*(b-a)+a)}function e(a){return a.splice(d(0,a.length),1)[0]}function f(a){let b=0;for(let c of a.children){let d=a.position[0]-c.position[0],e=a.position[1]-c.position[1];b+=1==d?C:-1==d?D:1==e?E:F}return b}function g(){let a=G.gl;a.clear(a.COLOR_BUFFER_BIT),H.draw(),j.requestAnimationFrame(g)}var h=Math.sin,i=Math.floor;let j=window,k=document,l=i;let m,n,o='precision mediump float;attribute vec2 h;uniform mat4 l,i,j;varying vec2 b;void main(){gl_Position=j*i*l*vec4(h,0,1),b=h;}',p={modelMat:'l',viewMat:'i',projMat:'j',squareType:'d',squareState:'f',t:'k'},q={vertPos:'h'};class r{constructor(a,...c){this.renderer=a;let d=this.shaderProgram=n.createProgram();for(let e=0;2>e;e+=1)n.attachShader(d,b(e,c[e]));for(let b in n.linkProgram(d),this.use(),p)this[b]=n.getUniformLocation(d,p[b]);for(let b in q)this[b]=n.getAttribLocation(d,q[b]),n.enableVertexAttribArray(this[b])}use(){this.renderer.use(this)}}let s=i(1e4*Math.random());let t=20,u=20,v=0.04;class w{constructor(a,b){this.untouched=[],this.children=[],this.touched=!1,this.distance=0,this.time=0,this.position=[a,b]}draw(){}}class x{get(a,b){let c=[a,b].toString();if(a>=t||b>=u||0>a||0>b)return null;let d=this[c];return d||(d=this[c]=new w(a,b)),d}}var y=function(){let a=new x,b=[[-1,0],[1,0],[0,-1],[0,1]];for(let c=0;c<t;c++)for(let d=0;d<u;d++){let e=a.get(c,d);for(let f of b){let b=a.get(c+f[0],d+f[1]);b&&e.untouched.push(b)}}let c=a.get(d(0,t),d(0,u)),f=[c];let g=c;for(;f.length;){let a=f[0];if(a.touched=!0,!a.untouched.length){f.shift();continue}let b=e(a.untouched);b.touched||(b.untouched.splice(b.untouched.indexOf(a),1),b.children.push(a),b.distance=a.distance+1,b.distance>g.distance&&(g=b),a.children.push(b),b.touched=!0,f.splice(0,0,b))}return[a,c,g]};class z{constructor(a,b){this.x=a,this.y=b}draw(){}simulate(){return!0}}let A=0.4;class B{constructor(a,b){this.renderer=a,this.maze=b,[this.x,this.y]=[b.start.position[0]+0.5,b.start.position[1]+0.5],this.program=new r(a,o,'precision mediump float;varying vec2 b;float g(float a){return 1.-a*a*a;}void main(){vec2 a=b-.5;float c=g(distance(vec2(0,0),a/.1));gl_FragColor=vec4(1,0,0,c);}')}draw(){this.program.use();let a=this.renderer.gl;a.bindBuffer(a.ARRAY_BUFFER,this.renderer.squareBuffer),a.vertexAttribPointer(this.program.vertPos,2,a.FLOAT,!1,0,0),this.renderer.modelMat=c(this.x-A/2,this.y-A/2,A),this.renderer.setMatrices(),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}let C=1,D=2,E=4,F=8;k.title='Lst';let G=new class{constructor(){this.camera=c(-8,-8,0.85,0),this.gl=n=a(),this.squareBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.squareBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),n.STATIC_DRAW)}use(a){this.currentProgram=a,n.useProgram(a.shaderProgram)}setMatrices(){let a=-10,b=10,c=10,d=-10,e=1/(a-b),f=1/(c-d);n.uniformMatrix4fv(this.currentProgram.viewMat,!1,this.camera),n.uniformMatrix4fv(this.currentProgram.modelMat,!1,this.modelMat),n.uniformMatrix4fv(this.currentProgram.projMat,!1,new Float32Array([-2*e,0,0,0,0,-2*f,0,0,0,0,2*(1/-160),0,(a+b)*e,(d+c)*f,0,1]))}},H=new class{constructor(a){for(let b in this.renderer=a,this.entities=[],this.downMap={},[this.grid,this.start,this.end]=y(),this.program=new r(a,o,'precision mediump float;uniform ivec4 d;uniform int f;uniform float k;varying vec2 b;float g(float a){return 1.-a*a*a;}void main(){vec4 c=vec4(0,0,0,1),e=vec4(1,1,1,1);e=f==0?vec4(0,.5,0,1):f==1?vec4(.5,0,0,1):f==2?vec4(.5,.5,.5,1):e;vec4 a=mix(vec4(.5,.5,.5,1),e,1.-g(f<2?1.:k));a=d.x==0&&b.x<.01?c:a,a=d.z==0&&b.x>.99?c:a,a=d.y==0&&b.y<.01?c:a,a=d.w==0&&b.y>.99?c:a,gl_FragColor=a;}'),this.grid){let a=this.grid[b];if(a!==this.start&&a!==this.end){let b=d(0,a.distance);for(let c=0;c<b;c+=1){let b=new z(a.position[0]+Math.random(),a.position[0]+Math.random());this.entities.push(b)}}}onkeydown=(a)=>{this.downMap[a.key.toLowerCase()]=1},onkeyup=(a)=>{this.downMap[a.key.toLowerCase()]=0},this.player=new B(a,this)}processInput(){let{player:a,grid:b,downMap:c}=this;let[d,e]=[a.x,a.y];let f=a.x,g=a.y,h=b.get(i(f),i(g));if(c.w&&(e-=v),c.s&&(e+=v),c.a&&(d-=v),c.d&&(d+=v),i(d)!==i(f)){let c=b.get(i(d),i(g));-1!==h.children.indexOf(c)&&(a.x=d)}else a.x=d;if(i(e)!==i(g)){let c=b.get(i(f),i(e));-1!==h.children.indexOf(c)&&(a.y=e)}else a.y=e;h.touched=!1,h.time||(h.time=Date.now())}draw(){this.processInput();let a=12,b=this.player;this.renderer.camera=new Float32Array([a,0,0,0,0,a,0,0,0,0,1,0,-a*b.x,-a*b.y,1,1]),this.program.use();let d=this.renderer.gl;d.bindBuffer(d.ARRAY_BUFFER,this.renderer.squareBuffer),d.vertexAttribPointer(this.program.vertPos,2,d.FLOAT,!1,0,0);for(let a=0;a<t;a+=1)for(let b=0;b<u;b+=1){this.renderer.modelMat=c(a,b),this.renderer.setMatrices();let e=this.grid.get(a,b),g=f(e);d.uniform1i(this.program.squareState,e===this.start?0:e===this.end?1:e.touched?2:3);let h=e.time?(Date.now()-e.time)/350:0;1<h&&(h=1),d.uniform1f(this.program.t,h),d.uniform4iv(this.program.squareType,[C&g,E&g,D&g,F&g]),d.drawArrays(d.TRIANGLE_STRIP,0,4)}let e=[];for(let a of this.entities){let b=a.simulate(this);b&&a.draw()}for(let a of e)this.entities.splice(this.entities.indexOf(a),1);b.draw()}}(G);g()</script>